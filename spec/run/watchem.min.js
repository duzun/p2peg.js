/*
 MIT
  @author Dumitru Uzun (DUzun.Me)

*/
(function(k,r){function s(){function b(a,b){a in f||(E("tracking ",a,': "'+(b+"").replace(/[\r\n]+/g," ").substr(0,64)+'"'),t.push(a),g[a]&&(F[a]=!0));f[a]=b}l&&clearTimeout(l);u&&clearTimeout(u);e.href=p.href;var c=y.call(m.scripts||m.querySelectorAll("script[src]")).map(G).filter(function(a){return a});O&&(c=c.concat(H().map(G).filter(function(a){return a})));P&&c.push(p.pathname+p.search.replace(v,""));var d=k.watchemToo,g={};d&&Object.keys(d).forEach(function(a){e.href=a;if(e.hostname!=I)delete d[a];
else{var b=e.pathname+e.search.replace(v,"");d[a]?(c.push(b),g[b]=!0):f[b]=!1}});c.forEach(function(a){a&&(a in f||z({url:w(a,A),type:A,headers:B},function(c,d,g){(c=C(g,c))?b(a,c):z({url:w(a,D),type:D,headers:B},function(c,d,g){c=C(g,c);J[a]=D;b(a,c)})}))});n=0;l=q&&setTimeout(K,q);u=L&&setTimeout(s,L);return f}function K(){var b=n,c=t[b],d=J[c]||A;z({url:w(c,d),type:d,headers:B},function(d,a,h){a=q;d=C(h,d);if(f[c]!=d)if(E("change detected in ",c,': "'+f[c]+'" != "'+d+'"'),"css"==M(c))h=H(c),h.length?
(h=h.pop(),(h.ownerNode||h).href=w(h.href),f[c]=d):x();else{x(F[c]?q:0);return}else n===b&&(++n,n>=t.length?n=0:a=4);l&&clearTimeout(l);l=a&&setTimeout(K,a)},function(b,a){x()})}function x(b){b?setTimeout(x.bind(r,0)):p.reload()}function H(b){for(var c=y.call(m.styleSheets||m.querySelectorAll("link[rel=stylesheet][href]")),d=[],g=0,a;g<c.length;g++)if(a=c[g],a.href)d.push(a);else if(a=a.cssRules)c=c.concat(y.call(a));b&&(e.href=b,b=e.href,d=d.filter(function(a){return(a=a.href)&&0==a.indexOf(b)}));
return d}function M(b){e.href=b;return e.pathname.split(".").pop()}function w(b,c){var d=b.replace(v,"");c&&"HEAD"!=c||(d+=(0>d.indexOf("?")?"?":"&")+N+"="+((Date.now()||(new Date).getTime())&4194303).toString(36));return d}function G(b){b=b.src||b.href;if(!b)return r;b=M(b);if(e.hostname!=I)return r;if(!(Q&&0<e.pathname.indexOf(".min.")))return-1<".css.js".indexOf(b)&&-1==e.pathname.indexOf("/jasmine/lib/")?e.pathname+e.search.replace(v,""):r}function C(b,c){if(b){var d=["Content-Type","Content-Length",
"Last-Modified","ETag"],g=[],a,e,f;for(a=d.length;a--;)if(f=b.getResponseHeader(e=d[a])){if("ETag"==e)return f;"Last-Modified"==e&&(f=(new Date(f)/1E3).toString(36));g[a]=f}if(g.length)return g.join("~")}return c}function E(){return k.console&&console.debug&&console.debug.apply(console,arguments)}var q=500,L=5E3,P=!0,O=!0,Q=!0,A="HEAD",D="GET",N="_w_",B={"X-Requested-With":"Watchem"},m=k.document,p=k.location,I=p.hostname,t=[],F={},f={},J={},y=t.slice,e=m.createElement("a"),v=RegExp("(\\?|\\&)"+N+
"=[^\\&]+"),n,l,u,z=k.jajax||function(b){return function(c,d,e){return b.ajax(c).done(d).fail(e)}}(k.jQuery||k.Zepto);"function"==typeof define&&define.amd?define([],s):(u=setTimeout(s,q),m.addEventListener("DOMContentLoaded",s))})(this);
